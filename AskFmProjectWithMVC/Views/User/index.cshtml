@model UserWithFollowingAnswerViewModel

@{
    ViewData["Title"] = "My Profile";
}


<h1 class="profile-heading">My Profile</h1>

<div class="profile-container">
    <img src="/Images/@Model.image" class="profile-image" />
    <h1 class="profile-name">@Model.username</h1>
    <small class="profile-follows profile-description">@Model.bio</small><br />
    <small style="margin:10px">@Model.followers followers</small><br />
   <button class="btn btn-outline-info">Edit The Profile</button>
    <div>
        <textarea placeholder="Ask Me Any Thing" cols="20" rows="6" oninput="onInput(event)" id="question" name="questionText" class="form-input form-control"></textarea>
        <div class="switch">
            <input id="unkown" type="checkbox" name="unkown">
            <label>ask as anonymous</label>
        </div>
        <input id="btn" disabled type="button" class="btn btn-outline-primary" onclick="onAsk()" value="Ask">
    </div>

</div>

@if (Model.FollowingAns.Count == 0)
{
    <h3 class="text-center">There is No Anwer To Show</h3>
}

@foreach (var item in Model.FollowingAns)
{

    <div class="card" id="@item.id">
        <div class="card-body">
                <img src="/Images/@Model.image"  />
            <div class="content">
                <p class="question">@item.question.question_text <small><a asp-action="profile" asp-route-id="@item.question.user_who_ask_id" class="asker">@item.question.user_who_ask?.username  </a></small></p>
                <div class="timestamp">
                    <cite class="source" title="Source Title">@item.post_date</cite> <!--@(item.question.post_date - DateTime.Now) -->
                </div>
                <h6 class="answer" id="theAnsewer_@item.id">@item.answer_text</h6>
                <button onclick="edite_answer(@item.id, '@item.answer_text')" class="edit_btn btn btn-outline-info">Edit</button>
                <button onclick="deleteAnswer(@item.id)" class="delete_btn btn btn-outline-danger">Delete</button>
            </div>
        </div>
    </div>
}


@section scripts {
   
    <script>
        const modalContainer = document.querySelector('.modal-container');
        const closeModal = document.querySelector('.close');
        const editeAnswerInput = document.getElementById("editeAnswer");
        const answer_id = document.getElementById("answer_id");
        closeModal.addEventListener('click', closeModel);
        function closeModel() {
            modalContainer.classList.remove('fade-in');
            modalContainer.style.display = 'none';
        }
        function edite_answer(id, answer_text) {
            modalContainer.classList.add('fade-in');
            modalContainer.style.display = 'block';
            answer_id.value = id;
            editeAnswerInput.value = answer_text;
        }
        function deleteAnswer(id) {
            var answerCard = document.getElementById(id);
            fetch("/Answer/deleteAnswer/" + id).then(res => {
                answerCard.style = "display: none";
            }).catch();
        }
        const btn = document.getElementById("btn");
        function onInput(e) {
            const length = e.target.value.length;
            if (length >= 3 && length <= 200)
                btn.removeAttribute("disabled");
            else
                btn.setAttribute("disabled", "");
        }
        function onAsk(){
            var question = document.getElementById("question");
            const unkown = document.getElementById("unkown");
            fetch("/User/ask/@Model.id?questionText=" + question.value + "&unkown=" + unkown.checked ).then(r => {
                btn.setAttribute("disabled", "");
                question.value = "";
            }
            ).catch() 
        }


        function saveEditeAnswer() {
            const theAnsewer = document.getElementById("theAnsewer_" + answer_id.value);
            fetch("/Answer/editAnswer/" + answer_id.value + "?answerText=" + editeAnswerInput.value).then(res => {
                closeModel();
                theAnsewer.innerHTML = editeAnswerInput.value;
            }).catch()
        }

        function onInputAnswer(e) {
            const btn = document.getElementById("saveAnswer");
            const length = e.target.value.length;
            if (length >= 3 && length <= 200)
                btn.removeAttribute("disabled");
            else
                btn.setAttribute("disabled", "");
        }
    </script>

}



@section styles {
    <link rel="stylesheet" href="~/css/profile.css" asp-append-version="true" />
}



<div class="modal-container">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit the Answer</h2>
        <input hidden id="answer_id" />
        <input oninput="onInputAnswer(event)" id="editeAnswer" type="text" class="form-input form-control" />
        <button id="saveAnswer" onclick="saveEditeAnswer()" class="btn btn-outline-info">Save</button>
    </div>
</div>